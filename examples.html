<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>Examples — PyMatting 1.1.10 documentation</title><link rel="stylesheet" href="/katex.min.css"><link rel="stylesheet" href="/style.css"><script src="/katex.min.js"></script></head><body><div class="sidebar"><div class="logo"><a href="/" class="sidebarlink"><img src="/figures/lemur_small.png" width="50px"></a><a href="/" class="logotext">PyMatting</a></div><div class="sidebarcontents">CONTENTS</div><ul><li><a href="/index.html" class="sidebarlink">PyMatting</a></li><li class="sidebarlink"><a href="/api.html" class="sidebarlink">API Reference</a><br><ul><li><a href="/alpha.html" class="sidebarlink">Alpha Estimation</a></li><li><a href="/cutout.html" class="sidebarlink">Cutout Function</a></li><li><a href="/foreground.html" class="sidebarlink">Foreground Estimation</a></li><li><a href="/laplacian.html" class="sidebarlink">Matting Laplacians</a></li><li><a href="/preconditioner.html" class="sidebarlink">Preconditioners</a></li><li><a href="/solver.html" class="sidebarlink">Solvers</a></li><li><a href="/util.html" class="sidebarlink">Utility Functions</a></li></ul></li><li><a href="/examples.html" class="sidebarlink currentpage">Examples</a></li><li><a href="/benchmarks.html" class="sidebarlink">Benchmarks</a></li><li><a href="/references.html" class="sidebarlink">Biblography</a></li><li><a href="https://pypi.org/project/PyMatting/" class="sidebarlink">PyPI</a></li><li><a href="https://www.github.com/pymatting/pymatting" class="sidebarlink">GitHub</a></li></ul></div><div class="middle"><h1>Examples</h1><div class="textblock"><span class="text">We provide different examples at different levels of abstraction.</span></div><h2><span class="text">Simple Example</span></h2><div class="textblock"><span class="text">This simple example is intended for application-oriented users.
All parameters were set beforehand and should work well on most images.
The </span><span class="inline_code"><span class="codeinline"><span class=name>cutout</span><span class=operator>(</span><span class=operator>)</span></span></span><span class="text"> method employs closed-form alpha matting </span><span class="citation"><a href="/references.html#LLW07">[LLW07]</a></span><span class="text"> and multi-level foreground extraction </span><span class="citation"><a href="/references.html#GUCH20">[GUCH20]</a></span><span class="text">.</span></div><div class="code_block"><div class="codeblock"><span class=keyword>from</span><span class=space> </span><span class=name>pymatting</span><span class=space> </span><span class=keyword>import</span><span class=space> </span><span class=name>cutout</span><span class=space>

</span><span class=name>cutout</span><span class=operator>(</span><span class=space>
   </span><span class=comment># input image path
</span><span class=space>   </span><span class=string>&quot;../data/lemur/lemur.png&quot;</span><span class=operator>,</span><span class=space>
   </span><span class=comment># input trimap path
</span><span class=space>   </span><span class=string>&quot;../data/lemur/lemur_trimap.png&quot;</span><span class=operator>,</span><span class=space>
   </span><span class=comment># output cutout path
</span><span class=space>   </span><span class=string>&quot;lemur_cutout.png&quot;</span><span class=operator>)</span></div></div><h2><span class="text">Advanced Example</span></h2><div class="textblock"><span class="text">The following example demonstrates the use of the </span><span class="inline_code"><span class="codeinline"><span class=name>estimate_alpha_cf</span><span class=operator>(</span><span class=operator>)</span></span></span><span class="text"> method as well as the </span><span class="inline_code"><span class="codeinline"><span class=name>estimate_foreground_ml</span><span class=operator>(</span><span class=operator>)</span></span></span><span class="text"> method.
Both methods can be easily replaced by other methods from the </span><span class="inline_code"><span class="codeinline"><span class=name>pymatting</span><span class=operator>.</span><span class=name>alpha</span></span></span><span class="text"> module and the </span><span class="inline_code"><span class="codeinline"><span class=name>pymatting</span><span class=operator>.</span><span class=name>foreground</span></span></span><span class="text"> module, respectively.
Parameters can be tweaked by passing them to the corresponding function calls.</span></div><div class="code_block"><div class="codeblock"><span class=keyword>from</span><span class=space> </span><span class=name>pymatting</span><span class=space> </span><span class=keyword>import</span><span class=space> </span><span class=operator>*</span><span class=space>
</span><span class=keyword>import</span><span class=space> </span><span class=name>numpy</span><span class=space> </span><span class=keyword>as</span><span class=space> </span><span class=name>np</span><span class=space>

</span><span class=name>scale</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=number>1.0</span><span class=space>

</span><span class=name>image</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=name>load_image</span><span class=operator>(</span><span class=string>&quot;../data/lemur/lemur.png&quot;</span><span class=operator>,</span><span class=space> </span><span class=string>&quot;RGB&quot;</span><span class=operator>,</span><span class=space> </span><span class=name>scale</span><span class=operator>,</span><span class=space> </span><span class=string>&quot;box&quot;</span><span class=operator>)</span><span class=space>
</span><span class=name>trimap</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=name>load_image</span><span class=operator>(</span><span class=string>&quot;../data/lemur/lemur_trimap.png&quot;</span><span class=operator>,</span><span class=space> </span><span class=string>&quot;GRAY&quot;</span><span class=operator>,</span><span class=space> </span><span class=name>scale</span><span class=operator>,</span><span class=space> </span><span class=string>&quot;nearest&quot;</span><span class=operator>)</span><span class=space>

</span><span class=comment># estimate alpha from image and trimap
</span><span class=name>alpha</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=name>estimate_alpha_cf</span><span class=operator>(</span><span class=name>image</span><span class=operator>,</span><span class=space> </span><span class=name>trimap</span><span class=operator>)</span><span class=space>

</span><span class=comment># make gray background
</span><span class=name>background</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=name>np</span><span class=operator>.</span><span class=name>zeros</span><span class=operator>(</span><span class=name>image</span><span class=operator>.</span><span class=name>shape</span><span class=operator>)</span><span class=space>
</span><span class=name>background</span><span class=operator>[</span><span class=operator>:</span><span class=operator>,</span><span class=space> </span><span class=operator>:</span><span class=operator>]</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=operator>[</span><span class=number>0.5</span><span class=operator>,</span><span class=space> </span><span class=number>0.5</span><span class=operator>,</span><span class=space> </span><span class=number>0.5</span><span class=operator>]</span><span class=space>

</span><span class=comment># estimate foreground from image and alpha
</span><span class=name>foreground</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=name>estimate_foreground_ml</span><span class=operator>(</span><span class=name>image</span><span class=operator>,</span><span class=space> </span><span class=name>alpha</span><span class=operator>)</span><span class=space>

</span><span class=comment># blend foreground with background and alpha, less color bleeding
</span><span class=name>new_image</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=name>blend</span><span class=operator>(</span><span class=name>foreground</span><span class=operator>,</span><span class=space> </span><span class=name>background</span><span class=operator>,</span><span class=space> </span><span class=name>alpha</span><span class=operator>)</span><span class=space>

</span><span class=comment># save results in a grid
</span><span class=name>images</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=operator>[</span><span class=name>image</span><span class=operator>,</span><span class=space> </span><span class=name>trimap</span><span class=operator>,</span><span class=space> </span><span class=name>alpha</span><span class=operator>,</span><span class=space> </span><span class=name>new_image</span><span class=operator>]</span><span class=space>
</span><span class=name>grid</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=name>make_grid</span><span class=operator>(</span><span class=name>images</span><span class=operator>)</span><span class=space>
</span><span class=name>save_image</span><span class=operator>(</span><span class=string>&quot;lemur_grid.png&quot;</span><span class=operator>,</span><span class=space> </span><span class=name>grid</span><span class=operator>)</span><span class=space>

</span><span class=comment># save cutout
</span><span class=name>cutout</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=name>stack_images</span><span class=operator>(</span><span class=name>foreground</span><span class=operator>,</span><span class=space> </span><span class=name>alpha</span><span class=operator>)</span><span class=space>
</span><span class=name>save_image</span><span class=operator>(</span><span class=string>&quot;lemur_cutout.png&quot;</span><span class=operator>,</span><span class=space> </span><span class=name>cutout</span><span class=operator>)</span><span class=space>

</span><span class=comment># just blending the image with alpha results in color bleeding
</span><span class=name>color_bleeding</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=name>blend</span><span class=operator>(</span><span class=name>image</span><span class=operator>,</span><span class=space> </span><span class=name>background</span><span class=operator>,</span><span class=space> </span><span class=name>alpha</span><span class=operator>)</span><span class=space>
</span><span class=name>grid</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=name>make_grid</span><span class=operator>(</span><span class=operator>[</span><span class=name>color_bleeding</span><span class=operator>,</span><span class=space> </span><span class=name>new_image</span><span class=operator>]</span><span class=operator>)</span><span class=space>
</span><span class=name>save_image</span><span class=operator>(</span><span class=string>&quot;lemur_color_bleeding.png&quot;</span><span class=operator>,</span><span class=space> </span><span class=name>grid</span><span class=operator>)</span></div></div><h2><span class="text">Expert Example</span></h2><div class="textblock"><span class="text">The third example provides an insight how PyMatting is working under-the-hood. The matting Laplacian matrix </span><span class="inline_code"><span class="codeinline"><span class=name>L</span></span></span><span class="text"> and the system of linear equations </span><span class="inline_code"><span class="codeinline"><span class=name>A</span><span class=space> </span><span class=name>x</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=name>b</span></span></span><span class="text"> are constructed manually. The solution vector </span><span class="inline_code"><span class="codeinline"><span class=name>x</span></span></span><span class="text"> is the flattened alpha matte.
The alpha matte </span><span class="inline_code"><span class="codeinline"><span class=name>alpha</span></span></span><span class="text"> is then calculated by solving the linear system using the </span><span class="inline_code"><span class="codeinline"><span class=name>cg</span><span class=operator>(</span><span class=operator>)</span></span></span><span class="text"> method. The convergence of the </span><span class="inline_code"><span class="codeinline"><span class=name>cg</span><span class=operator>(</span><span class=operator>)</span></span></span><span class="text"> method is accelerated with a preconditioner using the </span><span class="inline_code"><span class="codeinline"><span class=name>ichol</span><span class=operator>(</span><span class=operator>)</span></span></span><span class="text"> method.
This example is intended for developers and (future) contributors to demonstrate the implementation of the different alpha matting methods.</span></div><div class="code_block"><div class="codeblock"><span class=keyword>from</span><span class=space> </span><span class=name>pymatting</span><span class=space> </span><span class=keyword>import</span><span class=space> </span><span class=operator>*</span><span class=space>
</span><span class=keyword>import</span><span class=space> </span><span class=name>numpy</span><span class=space> </span><span class=keyword>as</span><span class=space> </span><span class=name>np</span><span class=space>
</span><span class=keyword>import</span><span class=space> </span><span class=name>scipy</span><span class=operator>.</span><span class=name>sparse</span><span class=space>

</span><span class=name>scale</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=number>1.0</span><span class=space>

</span><span class=name>image</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=name>load_image</span><span class=operator>(</span><span class=string>&quot;../data/lemur/lemur.png&quot;</span><span class=operator>,</span><span class=space> </span><span class=string>&quot;RGB&quot;</span><span class=operator>,</span><span class=space> </span><span class=name>scale</span><span class=operator>,</span><span class=space> </span><span class=string>&quot;box&quot;</span><span class=operator>)</span><span class=space>
</span><span class=name>trimap</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=name>load_image</span><span class=operator>(</span><span class=string>&quot;../data/lemur/lemur_trimap.png&quot;</span><span class=operator>,</span><span class=space> </span><span class=string>&quot;GRAY&quot;</span><span class=operator>,</span><span class=space> </span><span class=name>scale</span><span class=operator>,</span><span class=space> </span><span class=string>&quot;nearest&quot;</span><span class=operator>)</span><span class=space>

</span><span class=comment># height and width of trimap
</span><span class=name>h</span><span class=operator>,</span><span class=space> </span><span class=name>w</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=name>trimap</span><span class=operator>.</span><span class=name>shape</span><span class=operator>[</span><span class=operator>:</span><span class=number>2</span><span class=operator>]</span><span class=space>

</span><span class=comment># calculate laplacian matrix
</span><span class=name>L</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=name>cf_laplacian</span><span class=operator>(</span><span class=name>image</span><span class=operator>)</span><span class=space>

</span><span class=comment># decompose trimap
</span><span class=name>is_fg</span><span class=operator>,</span><span class=space> </span><span class=name>is_bg</span><span class=operator>,</span><span class=space> </span><span class=name>is_known</span><span class=operator>,</span><span class=space> </span><span class=name>is_unknown</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=name>trimap_split</span><span class=operator>(</span><span class=name>trimap</span><span class=operator>)</span><span class=space>

</span><span class=comment># constraint weight
</span><span class=name>lambda_value</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=number>100.0</span><span class=space>

</span><span class=comment># build constraint pixel selection matrix
</span><span class=name>c</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=name>lambda_value</span><span class=space> </span><span class=operator>*</span><span class=space> </span><span class=name>is_known</span><span class=space>
</span><span class=name>C</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=name>scipy</span><span class=operator>.</span><span class=name>sparse</span><span class=operator>.</span><span class=name>diags</span><span class=operator>(</span><span class=name>c</span><span class=operator>)</span><span class=space>

</span><span class=comment># build constraint value vector
</span><span class=name>b</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=name>lambda_value</span><span class=space> </span><span class=operator>*</span><span class=space> </span><span class=name>is_fg</span><span class=space>

</span><span class=comment># build linear system
</span><span class=name>A</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=name>L</span><span class=space> </span><span class=operator>+</span><span class=space> </span><span class=name>C</span><span class=space>

</span><span class=comment># build ichol preconditioner for faster convergence
</span><span class=name>A</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=name>A</span><span class=operator>.</span><span class=name>tocsr</span><span class=operator>(</span><span class=operator>)</span><span class=space>
</span><span class=name>A</span><span class=operator>.</span><span class=name>sum_duplicates</span><span class=operator>(</span><span class=operator>)</span><span class=space>
</span><span class=name>M</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=name>ichol</span><span class=operator>(</span><span class=name>A</span><span class=operator>)</span><span class=space>

</span><span class=comment># solve linear system with conjugate gradient descent
</span><span class=name>x</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=name>cg</span><span class=operator>(</span><span class=name>A</span><span class=operator>,</span><span class=space> </span><span class=name>b</span><span class=operator>,</span><span class=space> </span><span class=name>M</span><span class=operator>=</span><span class=name>M</span><span class=operator>)</span><span class=space>

</span><span class=comment># clip and reshape result vector
</span><span class=name>alpha</span><span class=space> </span><span class=operator>=</span><span class=space> </span><span class=name>np</span><span class=operator>.</span><span class=name>clip</span><span class=operator>(</span><span class=name>x</span><span class=operator>,</span><span class=space> </span><span class=number>0.0</span><span class=operator>,</span><span class=space> </span><span class=number>1.0</span><span class=operator>)</span><span class=operator>.</span><span class=name>reshape</span><span class=operator>(</span><span class=name>h</span><span class=operator>,</span><span class=space> </span><span class=name>w</span><span class=operator>)</span><span class=space>

</span><span class=name>save_image</span><span class=operator>(</span><span class=string>&quot;lemur_alpha.png&quot;</span><span class=operator>,</span><span class=space> </span><span class=name>alpha</span><span class=operator>)</span></div></div><footer>© Copyright 2023, Thomas Germer, Tobias Uelwer, Stefan Conrad, Stefan Harmeling</footer></div><script src="/auto-render.min.js" onload="renderMathInElement(document.body)"></script></body></html>